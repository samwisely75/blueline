#!/bin/sh
#
# Pre-commit hook to enforce clippy format string checks
# Prevents commits with clippy::uninlined_format_args warnings
#

set -e

echo "ğŸ¨ Running cargo fmt check..."

# Check if code is properly formatted
if ! cargo fmt --all -- --check > /dev/null 2>&1; then
    echo ""
    echo "âŒ COMMIT REJECTED: Code formatting issues found!"
    echo ""
    echo "Please run 'cargo fmt' to format your code before committing:"
    echo ""
    cargo fmt --all -- --check
    echo ""
    echo "ğŸ’¡ Tip: Run 'cargo fmt' to automatically format your code"
    echo ""
    exit 1
fi

echo "âœ… Code formatting check passed!"

echo "ğŸ” Running cargo clippy check..."

# Run clippy with warnings as errors
if ! cargo clippy --all-targets --all-features -- -D warnings > /dev/null 2>&1; then
    echo ""
    echo "âŒ COMMIT REJECTED: Clippy warnings found!"
    echo ""
    echo "Please fix the following clippy warnings before committing:"
    echo ""
    cargo clippy --all-targets --all-features -- -D warnings
    echo ""
    echo "ğŸ’¡ Tip: Use modern format string syntax like format!(\"Hello {name}\") instead of format!(\"Hello {}\", name)"
    echo ""
    exit 1
fi

echo "âœ… Clippy check passed!"
echo "ğŸ‰ All pre-commit checks passed! Code is properly formatted and lint-free."
