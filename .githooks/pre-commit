#!/bin/sh
#
# Pre-commit hook to enforce clippy format string checks
# Prevents commits with clippy::uninlined_format_args warnings
#

set -e

echo "> Running cargo fix..."
if ! cargo fix -q --allow-dirty --allow-staged --all-targets --all-features > /dev/null 2>&1; then
    echo "❌ Auto format failed!"
fi

echo "✅ Code format issues fixed!"


# Check if code is properly formatted
echo "> Running cargo fmt check..."

if ! cargo fmt > /dev/null 2>&1; then
    echo "❌ Format warnings!"
    echo ""
    cargo fmt
    echo ""
    echo "❌ PRE-CHECK FAILED: Fix the warnings and come back again!"
    exit 1
fi

echo "✅ Code formatting check passed!"
echo "> Running cargo clippy check..."

# Run clippy with warnings as errors
if ! cargo clippy --all-targets --all-features -- -D warnings > /dev/null 2>&1; then
    echo "❌ Clippy check warnings!"
    echo ""
    cargo clippy -q --all-targets --all-features -- -D warnings || true
    echo ""
    echo "❌ PRE-CHECK FAILED: Fix the warnings and come back again!"
    exit 1
fi

echo "✅ Clippy check passed!"
echo "✅ PRE-CHECK SUCCESSFUL: You can now commit your changes."
